<html>
	<head>
		<title>
			Duel_the_Game

		</title>
		<!-- local file below -->
		<!-- ==================================== -->
		<!--our css file -->
		<link rel='stylesheet' href='Style.css'>

		<!-- our js file here-->
		<script language="JavaScript" src="card.js"></script>
		<!-- a "card" object array name card-->
		<script language="JavaScript" src="mission.js"></script>
		<!-- a "mission" object array name mission-->
		<script language="JavaScript" src="sprite.js"></script>
		<!-- a "sprite" object array name sprite-->
		<script language="JavaScript" src="item.js"></script>
		<!-- a "item" object array name item-->
		<!-- ==================================== -->

		<!-- module below-->
		<!-- ==================================== -->
		<!-- jquery -->
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
		<!-- future socket.io here --> 
		<!--<script src="/socket.io/socket.io.js"></script>-->
		<script src="/socket.io/socket.io.js"></script>
    	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>

		<!-- ==================================== -->
	</head>
	
	<script>
		let socket = io();
		var round = 1;
		var player_act = {"action":"none", "item":"none"};
		var playerId;

		//message
		var num_message = 0; 
		var MAX_MESSAGE = 15; 
		function addMessage(Text){
			if(num_message>= MAX_MESSAGE){
				$("#message div:nth-child(1)").remove();
			}

			if(num_message %2 ==0){
				$("#message").append("<div class=\"message_div\" style=\"background-color:#F0F8FF;\">"+Text+"</div>");
			} 
			else{
				$("#message").append("<div class=\"message_div\" style=\"background-color:#DCDCDC\">"+Text+"</div>");
			}
			num_message+=1;
		}

		//選擇角色
		socket.on("welcome",()=>{ //when start,hide the main page to let player select charcters.
			$("#LEFT").hide();
			$("#RIGHT").hide();
		})

		socket.on("pl1_choosed", ()=>{ 
			$("#pl1").hide();
		})
		socket.on("pl2_choosed", ()=>{
			$("#pl2").hide();
		})
		
		// player finish selecting , game start and display main page
		socket.on("start_game", (hp, atk, def, crit)=>{
			$("#choose_pl").hide();
			$("#LEFT").show();
			$("#RIGHT").show();
			$("#my_hp").text(hp);
			$("#my_atk").text(atk);
			$("#my_def").text(def);
			$("#my_crit").text(crit*100 + "%");
			$("#enemy_hp").text(hp);
			$("#enemy_atk").text(atk);
			$("#enemy_def").text(def);
			$("#enemy_crit").text(crit*100 + "%");
		})

		socket.on("dmg", (dmg1, dmg2, p1Action, p2Action)=>{ // 顯示上回合造成得傷害
			if(playerId==1){
				addMessage("你對敵方造成造成" + dmg1 + "點傷害");
				addMessage("敵方上回合的行動:" + p2Action);
				addMessage("敵方對你造成" + dmg2 + "點傷害");
			}else if(playerId==2){
				addMessage("你對敵方造成造成" + dmg2 + "點傷害");
				addMessage("敵方上回合的行動:" + p1Action);
				addMessage("敵方對你造成" + dmg1 + "點傷害");
			}
		});
		socket.on("next_round", (p1_hp, p2_hp)=>{  //更新雙方血量
			if(playerId==1){
				$("#my_hp").text(p1_hp);
				$("#enemy_hp").text(p2_hp);
			}else if(playerId==2){
				$("#my_hp").text(p2_hp);
				$("#enemy_hp").text(p1_hp);
			}
			round += 1;
			$("#round").text(round);
			player_act.action = "none";
			player_act.item = "none";
		})
		socket.on("game_over", (loser)=>{
			if(loser==0){
				addMessage("平手");
			}else if(loser==playerId){
				addMessage("你輸了");
			}else{
				addMessage("你贏了");
			}
		})

		/*
		//更新每回合雙方血量
		socket.on("update", (p1_hp, p2_hp, msg1, msg2)=>{
			if(playerId==1){
				$("#my_hp").text(p1_hp);
				$("#enemy_hp").text(p2_hp);
				addMessage("你對敵方" + msg2);
				addMessage("敵方對你" + msg1);
			}else if(playerId==2){
				$("#my_hp").text(p2_hp);
				$("#enemy_hp").text(p1_hp);
				addMessage("你對敵方" + msg1);
				addMessage("敵方對你" + msg2);
			}
			round += 1;
			$("#round").text(round);
		})

		//顯示當回合選擇的行動
		socket.on("act_ready", (type)=>{
			addMessage("你選擇了" + type);
		})
		*/

		$(document).ready(()=>{
			//選擇玩家
			$("#pl1").click(()=>{
				playerId = 1;
				$("#pl1").hide();
				$("#pl2").hide();
				$("#pl").text("你是玩家1");
				socket.emit("choose_character", 1);
			});
			$("#pl2").click(()=>{
				playerId = 2;
				$("#pl1").hide();
				$("#pl2").hide();
				$("#pl").text("你是玩家2");
				socket.emit("choose_character", 2);
			});

			//選擇行動
			$("#action_atk").click(()=>{
				player_act.action = "atk";
				addMessage("你選擇了攻擊");
				$("#show_action").text("攻擊");
				socket.emit("choose_action", "atk", playerId);
			});
			$("#action_def").click(()=>{
				player_act.action = "def";
				addMessage("你選擇了防禦");
				$("#show_action").text("防禦");
				socket.emit("choose_action", "def", playerId);
			});

			//選擇道具
			$("#item_use").click(()=>{
				player_act.item = "use";
				addMessage("你選擇使用道具");
				socket.emit("choose_item", "use", playerId);
			});
			$("#item_discard").click(()=>{
				player_act.item = "del";
				addMessage("你選擇丟棄道具");
				socket.emit("choose_item", "delete", playerId);
			})

			$("#action_done").click(()=>{
				socket.emit("action_done", playerId, player_act.action, player_act.item);
				addMessage("你結束了這回合，等待對方行動");
				player_act.action = "none";
				player_act.item = "none";
			})
		});
	</script>

	<body>
	
	<div id="choose_pl">
		<p id="pl">請選擇角色</p>
		<button id="pl1">player1</button>
      	<button id="pl2">player2</button>
	</div>


	<!-- Display section below -->
	<div id="LEFT">
	
	

    <!-- our status showing below-->
	<!-- ==================================== -->
		<div id="LEFT_TOP">
		<!--屬性欄，此div為最外框-->
    	<div id="my_status" >我方當前狀態 

        <div id="my_basic-data">
        	<!--基本數值-->
			<div>回合數: 第<span id="round"> 1 </span>回合</div>
			<div>HP: <span id="my_hp">  </span> </div>
            <div>ATK: <span id="my_atk"></span> </div>
			<div>DEF: <span id="my_def"></span> </div>
			<div>Critical: <span id="my_crit"></span> </div>
			<div>Critical Damage: <span id="my_crit_dng">x2</span> </div>
        
        </div>

      
		
		<div id="my_sprite">精靈欄 空</div>
	
		<div id="my_sprite_content" class="status_content"></div>


		<div id="my_item" >道具欄: 空</div>
		
		<div id="my_item_content" class="status_content"></div>
		

		
	
	    
        </div> <!-- id=LEFT_TOP closing tag , this section ending here-->

	<!-- all status showing above-->
	<!-- ==================================== -->

	
	<!-- enemy status showing below-->
	<!-- ==================================== -->

		<!--屬性欄，此div為最外框-->
    	<div id="enemy_status" >敵方當前狀態 

        <div id="enemy_basic-data">
        	<!--基本數值-->
			<br>
			<div>HP: <span id="enemy_hp">  </span> </div>
            <div>ATK: <span id="enemy_atk"></span> </div>
			<div>DEF: <span id="enemy_def"></span> </div>
			<div>Critical: <span id="enemy_crit"></span> </div>
			<div>Critical Damage: <span id="enemy_crit_dmg">X2</span> </div>
        
        </div>

      
		
		<div id="enemy_sprite">精靈欄 空</div>
	
		<div id="enemy_sprite_content" class="status_content"></div>

		<!--
		<div id="enemy_item" >道具欄: 空</div>
		
		<div id="enemy_item_content" class="status_content"></div>
		-->

		
	
	    
        </div> <!-- id=enemy_status closing tag -->

        </div><!-- id=status closing tag , this section ending here-->
	<!-- all status showing above-->
	<!-- ==================================== -->



	







	<!-- all buttons or something user interaction below-->
	<!-- ==================================== -->
	<div id="LEFT_BOTTOM">
		<div id="mission_sector">
			<div id="my_mission">當前任務: 空</div>
				
			<div id="my_mission_content" class="status_content"></div>
		</div> <!-- mission sector ending here-->
	<!-- ''''''''''''''''''''''''''''''''''''''''''
		Note: you can use this format:

		<div>
    			<button id="action_atk" class="interact-button">  Action </button>
    			Description
    	</div>

		to add new action button 
		''''''''''''''''''''''''''''''''''''''''''  -->

    	<div id="interact_sector" >操作角色
    		<div id="turn_action" class="interact-sector">
    		本回合行動

    			<div>
    			<button id="action_atk" class="interact-button"> 攻擊 </button>
    			此回合攻擊對方，有機會造成爆擊
    			</div>

    			<div>
				<button id="action_def" class="interact-button">防禦</button>
				此回合提升50%防禦力
				</div>                       

				<div>
				當前採取行動為: <span id="show_action" style="color:red"> </span>
				</div>

    			
			</div> <!-- turn_action 的closing tag-->

			<div id="item_action" class="interact-sector">
			道具欄操作<br>
				<div>
					<button id="item_use" class="interact-button">使用道具</button>
					使用當前道具欄的道具
				</div>

				<div>
				<button id="item_discard" class="interact-button">丟棄道具</button>
				丟棄當前道具欄的道具
				</div>
			</div> <!-- item_action 的closing tag-->

			<div id="misson_action" class="interact-sector">任務操作
    			<div>
					<button id="misson_discard" class="interact-button">放棄任務</button>
					放棄執行當前任務
				</div>
				<div>
					<button id="pick_card" class="interact-button">抽卡</button>
					隨機抽取一張卡片
				</div>

			</div> <!-- id= mission_action 的closing tag-->
			
			<div id="round_done" class="interact-sector">結束這回合
				<div>
					<button id="action_done" class="interact-button">確認</button>
				</div>
			</div>

    		


    	</div> <!-- id=interact div closing tag, this section ending here  -->

    </div> <!-- id=LEFT Bottom ending here-->
    <!-- all buttons or something user interaction above-->
	<!-- ==================================== -->

</div> <!-- id=LEFT  ending here-->

<div id="RIGHT">
<!-- show message below--> 
		<!-- ==================================== -->
		
    	<div id="message">message
	

    	</div>
        
        
        <!-- show message above--> 
		<!-- ==================================== -->

</div> 



</body>



</html>
